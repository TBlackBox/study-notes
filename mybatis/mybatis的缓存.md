
# 一级缓存
一级缓存也就是本地缓存，是sqlSession级别的，一级缓存一直是开启的。


1. 4种失效情况
+ sqlSession不同，一级缓存失效。（sqlSession不同）
+ 查询条件不同，一级缓存失效。（sqlSession相同）
+ 有增删改，一级缓存失效。（sqlSession相同）
+ 清除了缓存，一级缓存失效（sqlSession相同）

*** 注意：清缓存语句`openSession.clearCache()` ***


# 二级缓存
1. 工作机制
一个会话查询一条数据，会放在一级缓存中，如果会话关闭，一级会话的数据会保存到二级缓存中。二级缓存又叫全局缓存，是基于namespace的，不同的namespace查出的数据会放在自己对应的map中。默认是关闭的。


2。 开启二级缓存
* 在mybatis.xml配置文件中开启二级缓存
```
<setting name="cacheEnabled" value="true"/>
```

* mybatis 3默认情况下，只启用了本地的会话缓存，它仅仅对一个会话中的数据进行缓存。 要启用全局的二级缓存，只需要在你的 SQL 映射文件中添加一行：
```
<cache/>
```
`cache`的一些策略
eviction 缓存的回收策略
1. LRU – 最近最少使用：移除最长时间不被使用的对象。
2. FIFO – 先进先出：按对象进入缓存的顺序来移除它们。
3. SOFT – 软引用：基于垃圾回收器状态和软引用规则移除对象。
4. WEAK – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。

flushInterval 刷新间隔  

属性可以被设置为任意的正整数，设置的值应该是一个以毫秒为单位的合理时间量。 默认情况是不设置，也就是没有刷新间隔，缓存仅仅会在调用语句时刷新。

readOnly（只读） 

属性可以被设置为 true 或 false。只读的缓存会给所有调用者返回缓存对象的相同实例。 因此这些对象不能被修改。这就提供了可观的性能提升（不安全）。而可读写的缓存会（通过序列化）返回缓存对象的拷贝。 速度上会慢一些，但是更安全，因此默认值是 false。

size（引用数目）   
属性可以被设置为任意正整数，要注意欲缓存对象的大小和运行环境中可用的内存资源。默认值是 1024。

type
使用自定义缓存
除了上述自定义缓存的方式，你也可以通过实现你自己的缓存，或为其他第三方缓存方案创建适配器，来完全覆盖缓存行为。

<cache type="com.domain.something.MyCustomCache"/>


3. 查询的数据需要实现序列化接口


*** 注意：***
1. select语句中的`userCache`只对二级缓存有效
2. 没有过增删改都有一个`flushCache=true`一级缓存都清空了，二级缓存也会被清除。
3. `clearCache()`只清除一级缓存，二级缓存没有影响
4. `localCacheScope`本地缓存作用域：（一级缓存SESSION）;当前会还的所有数据，如果设置问`STATEMENT`可以禁用一级缓存。