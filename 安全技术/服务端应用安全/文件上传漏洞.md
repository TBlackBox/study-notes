# 简介
越来越多的web应用需要上传文件，图片等。看似简单的功能，如果一不注意，将成为攻击者攻击的对象。


# 文件上传漏洞的概念
用户上传了一个可执行的脚本文件，并通过此脚本文件获得执行服务器端命令的能力，这种攻击方式是最为直接和有效的，有时候几乎不需要任何的技术门槛。

# 富文本编辑器的漏洞
FCKEditor是富文本编辑器，上传功能出现多次漏洞。

攻击者可以手动修改上传过程中的POST包绕过文件上传检查。

例如：`0x00`字符截断问题。

# 基于Web Service的漏洞
## Apache文件解析问题
老版本是从文件名的后方向像前解析，匹配mine.typesm名单。

## IIS解析问题
老版本存在文件截断问题
## 利用文件上传钓鱼
老版本IE浏览器将钓鱼图片当做HTML执行。


# 设计安全的文件上传功能
## 将文件上传的目录设置为不可执行
- 放到单独的独立存储系统上

## 判断文件类型
- 通过白名单 的方式检查文件类型，可以结合MIME Type判断。
- 对于图片采用压缩函数或者resize函数处理可能包含的HTML代码。
- 使用随机书改写文件名和文件路径

极大的增加了工具成本

- 单独设置文件服务器的域名

# 总结
文件上传问题，看起来简单，但要实现一个安全的上传功能，确实不易，如果还要考虑到病毒，木马，色情图片与视频，反动政治的业务，那还是要做不少工作哦。。。