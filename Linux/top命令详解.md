# 简介
top命令是Linux下常用的性能分析工具，能够实时显示系统中各个进程的资源占用状况，类似于Windows的任务管理器。

# 语法
```shell
top [-] [d delay] [q] [c] [S] [s] [i] [n] [b]
```
## **参数说明**：

- d : 改变显示的更新速度，或是在交谈式指令列( interactive command)按 s

- q : 没有任何延迟的显示速度，如果使用者是有 superuser 的权限，则 top 将会以最高的优先序执行

- c : 切换显示模式，共有两种模式：

	- 一是只显示执行档的名称
	- 一种是显示完整的路径与名称S
		累积模式，会将己完成或消失的子行程 ( dead child process ) 的 CPU time 累积起来

- s : 安全模式，将交谈式指令取消, 避免潜在的危机

- i : 不显示任何闲置 (idle) 或无用 (zombie) 的行程

- n : 更新的次数，完成后将会退出 top

- b : 批次档模式，搭配 "n" 参数一起使用，可以用来将 top 的结果输出到档案内

## 实例

显示进程信息

```shell
# top
```

显示完整命令

```shell
# top -c
```

以批处理模式显示程序信息

```
# top -b
```

以累积模式显示程序信息

```
# top -S
```

设置信息更新次数，表示更新两次后终止更新显示

```
top -n 2     
```

设置信息更新时间，表示更新周期为3秒

```
# top -d 3   
```

显示指定的进程信息 ，显示进程号为139的进程信息，CPU、内存占用率等

```
# top -p 139   
```

显示更新十次后退出

```
top -n 10
```

使用者将不能利用交谈式指令来对行程下命令

```
top -s
```



# 参数详解
```shell
top - 14:06:22 up 55 days,  2:13,  1 user,  load average: 0.33, 0.21, 0.16
Tasks: 306 total,   1 running, 305 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.6 us,  0.1 sy,  0.0 ni, 99.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem :  3876080 total,   252540 free,  2434444 used,  1189096 buff/cache
KiB Swap:  1048572 total,  1003280 free,    45292 used.   993772 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                
   74 root      20   0       0      0      0 S   0.3  0.0   3:13.59 rcuos/0                                
 3068 mysql     20   0 4916368 464596  10096 S   0.3 12.0  46:50.12 mysqld                                 
19843 root      20   0  738300  18520   4732 S   0.3  0.5  16:27.29 BT-Task           
```

**第一行，任务队列信息，同 uptime 命令的执行结果**

> 系统时间：14:06:22
>
> 运行时间：up 55 days,
>
> 当前登录用户： 1 user
>
> 负载均衡(uptime) load average: 0.33, 0.21, 0.16
>
>    average后面的三个数分别是1分钟、5分钟、15分钟的负载情况。
>
> load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了

**第二行，Tasks — 任务（进程）**

> 总进程:306total, 运行:1 running, 休眠:305sleeping, 停止: 0 stopped, 僵尸进程: 0 zombie

**第三行，cpu状态信息**

> 0.6%us【user space】— 用户空间占用CPU的百分比。
>
> 0.1%sy【sysctl】— 内核空间占用CPU的百分比。
>
> 0.0%ni【】— 改变过优先级的进程占用CPU的百分比
>
> 99.2%id【idolt】— 空闲CPU百分比
>
> 0.0%wa【wait】— IO等待占用CPU的百分比
>
> 0.0%hi【Hardware IRQ】— 硬中断占用CPU的百分比
>
> 0.0%si【Software Interrupts】— 软中断占用CPU的百分比

**第四行,内存状态**

>  3876080 total,   252540 free,  2434444 used,  1189096 buff/cache【缓存的内存量】

**第五行，swap交换分区信息**

> 1048572 total,  1003280 free,    45292 used.   993772 avail Mem【还能用的内存】

> 备注：
>
> 可用内存 = free + buffer + cached
>
> 对于内存监控，在top里我们要时刻监控第五行swap交换分区的used，如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，这是真正的内存不够用了。
>
> 第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，
>
> 第四行中空闲内存总量（free）是内核还未纳入其管控范围的数量。
>
> 纳入内核管理的内存不见得都在使用中，还包括过去使用过的现在可以被重复利用的内存，内核并不把这些可被重新使用的内存交还到free中去，因此在linux上free内存会越来越少，但不用为此担心。

**第六行，空行**

**第七行以下：各进程（任务）的状态监控**

> PID — 进程id
> USER — 进程所有者
> PR — 进程优先级
> NI — nice值。负值表示高优先级，正值表示低优先级
> VIRT — 进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES
> RES — 进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA
> SHR — 共享内存大小，单位kb
> S —进程状态。D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程
> %CPU — 上次更新到现在的CPU时间占用百分比
> %MEM — 进程使用的物理内存百分比
> TIME+ — 进程使用的CPU时间总计，单位1/100秒
> COMMAND — 进程名称（命令名/命令行）

详解

> **VIRT：virtual memory usage 虚拟内存
> **1、进程“需要的”虚拟内存大小，包括进程使用的库、代码、数据等
> 2、假如进程申请100m的内存，但实际只使用了10m，那么它会增长100m，而不是实际的使用量
>
> **RES：resident memory usage 常驻内存**
> 1、进程当前使用的内存大小，但不包括swap out
> 2、包含其他进程的共享
> 3、如果申请100m的内存，实际使用10m，它只增长10m，与VIRT相反
> 4、关于库占用内存的情况，它只统计加载的库文件所占内存大小
>
> **SHR：shared memory 共享内存**
> 1、除了自身进程的共享内存，也包括其他进程的共享内存
> 2、虽然进程只使用了几个共享库的函数，但它包含了整个共享库的大小
> 3、计算某个进程所占的物理内存大小公式：RES – SHR
> 4、swap out后，它将会降下来
>
> **DATA**
> 1、数据占用的内存。如果top没有显示，按f键可以显示出来。
> 2、真正的该程序要求的数据空间，是真正在运行中要使用的。
>
> **top 运行中可以通过 top 的内部命令对进程的显示方式进行控制。内部命令如下：**
> s – 改变画面更新频率
> l – 关闭或开启第一部分第一行 top 信息的表示
> t – 关闭或开启第一部分第二行 Tasks 和第三行 Cpus 信息的表示
> m – 关闭或开启第一部分第四行 Mem 和 第五行 Swap 信息的表示
> N – 以 PID 的大小的顺序排列表示进程列表
> P – 以 CPU 占用率大小的顺序排列进程列表
> M – 以内存占用率大小的顺序排列进程列表
> h – 显示帮助
> n – 设置在进程列表所显示进程的数量
> q – 退出 top
> s – 改变画面更新周期



# 查看多核cpu占用信息

**1 top 命令，然后按数字“1”可监控每个逻辑CPU的状况**

**如果不按1，则在top视图里面显示的是所有cpu的平均值。也就是第三行cpu的信息**

```shell
//命令没经过验证
# mpstat -P ALL 
# sar -P ALL 
说明：sar -P ALL > 1.txt   重定向输出内容到文件 1.txt
```

# **进程字段排序**

默认进入top时，各进程是按照CPU的占用量来排序的。可通过键盘指令来改变排序字段，比如想监控哪个进程占用MEM最多，我一般的使用方法如下：

1.  敲击键盘“b”（打开/关闭加亮效果）
2. 我们发现“top”进程被加亮了，可以通过敲击“y”键关闭或打开运行态进程的加亮效果。
3. 敲击键盘“x”（打开/关闭排序列的加亮效果）
4. 通过”shift + >”或”shift + <”可以向右或左改变排序列

# **改变进程显示字段**

1.  敲击“f”键，top进入另一个视图，在这里可以编排基本视图中的显示字段

2. 这里列出了所有可在top基本视图中显示的进程字段，有”*”并且标注为大写字母的字段是可显示的，没有”*”并且是小写字母的字段是不显示的。

   （空格  表示前面*  表示选中）