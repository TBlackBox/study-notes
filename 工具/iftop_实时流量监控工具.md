# 简介
iftop是类似于top的实时流量监控工具。iftop可以用来监控网卡的实时流量（可以指定网段）、反向解析IP、显示端口信息等，详细的将会在后面的使用参数中说明。  
[官方地址](http://www.ex-parrot.com/~pdw/iftop/)

# 安装
1. 通过编译安装
+ 安装必须要的包
安装前需要已经安装好基本的编译所需的环境，比如make、gcc、autoconf等。安装iftop还需要安装libpcap和libcurses。

CentOS上安装所需依赖包：
```
yum install flex byacc  libpcap ncurses ncurses-devel libpcap-devel
```

Debian上安装所需依赖包：
```
apt-get install flex byacc  libpcap0.8 libncurses5
```

+ 下载源码并安装
```
wget http://www.ex-parrot.com/pdw/iftop/download/iftop-0.17.tar.gz

tar zxvf iftop-0.17.tar.gz

cd iftop-0.17

./configure

make && make install
```

# 运行
直接运行下面命令
```
iftop
```

# iftop界面相关说明
从界面上看可以分为3部分
+ 第一部分：也就是第一行  可以看成是刻度，为显示流量图形的长条作标尺用的。
+ 第二部分：第二部分为左中右，左列和中列记录了哪些IP或主机正在本机的网络进行连接。中间的<= =>这两个左右箭头，表示的是流量的方向。最右列又分为三个小列，这些实时参数分别表示外部IP连接到本机2s 10s和40s的平均流量。另外这个部分还有一个流量图形条，流量图形条是对流量大小的动态展示，以第一部分中的流量刻度为基准。通过这个流量图形条可以很方便的看出那个IP的流量最大，今儿迅速定位网络中可能出现的流量问题；
+ 第三部分：也就是下面的参数说明了，一看就明白，这里都不多说了。


|参数|说明|
|-----|------|
|TX|发送流量|
|RX|接收流量|
|TOTAL|总流量|
|Cumm|运行iftop到目前时间的总流量|
|peak|流量峰值|
|rates|分别表示过去 2s 10s 40s 的平均流量|


# iftop相关参数
## 常用参数
|参数|说明|例子| 
|-------|-------|----|
|-i|设定监测的网卡 |iftop -i eth0| 
|-B |以bytes为单位显示流量(默认是bits) |iftop -B |
|-n|使host信息默认直接都显示IP|iftop -n|
|-N|使端口信息默认直接都显示端口号|iftop -N|
|-F|显示特定网段的进出流量|iftop -F 10.10.1.0/24或iftop -F 10.10.1.0/255.255.255.0|
|-h|（display this message），帮助，显示参数信息|
|-p|使用这个参数后，中间的列表显示的本地主机信息，出现了本机以外的IP信息|
|-b|使流量图形条默认就显示|
|-f|这个暂时还不太会用，过滤计算包用的|
|-P|使host信息及端口信息默认就都显示|
|-m|设置界面最上边的刻度的最大值，刻度分五个大段显示|# iftop -m 100M|


## 进入iftop画面后的一些操作命令

|命令（注意大小写）|说明| 
|-------|-------|
|h|切换是否显示帮助|
|n|切换显示本机的IP或主机名|
|s|切换是否显示本机的host信息|
|d|切换是否显示远端目标主机的host信息|
|t|切换显示格式为2行/1行/只显示发送流量/只显示接收流量|
|N|切换显示端口号或端口服务名称|
|S|切换是否显示本机的端口信息|
|D|切换是否显示远端目标主机的端口信息|
|p|切换是否显示端口信息|
|P|切换暂停/继续显示|
|b|切换是否显示平均流量图形条|
|B|切换计算2秒或10秒或40秒内的平均流量|
|T|切换是否显示每个连接的总流量|
|l|打开屏幕过滤功能，输入要过滤的字符，比如ip,按回车后，屏幕就只显示这个IP相关的流量信息|
|L|切换显示画面上边的刻度;刻度不同，流量图形条会有变化|
|j或k|可以向上或向下滚动屏幕显示的连接记录|
|1或2或3|可以根据右侧显示的三列流量数据进行排序|
|<|根据左边的本机名或IP排序|
|>|根据远端目标主机的主机名或IP排序|
|o|切换是否固定只显示当前的连接|
|q|退出监控|


# 总结
这里只列出了一些常用的，更深入的使用需看官方问题和其他更全的资料。